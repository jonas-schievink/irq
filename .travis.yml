language: rust
rust:
  - 1.39.0
  - stable
  - nightly
sudo: false
env:
  global:
    - RUSTFLAGS="--deny warnings"
    - RUST_BACKTRACE=1
    - CARGO_INCREMENTAL=0  # decrease size of `target` to make the cache smaller
  matrix:
    - FEATURES=""  # default configuration
before_script:
  - rustup target add thumbv6m-none-eabi
script:
  - cargo test --all $FEATURES

  # Ensure we can build for targets without atomic swap instructions.
  - cargo build --target thumbv6m-none-eabi
notifications:
  email:
    on_success: never
